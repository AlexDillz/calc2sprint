# Калькулятор Выражений (Distributed Arithmetic Expression Calculator)

Этот проект представляет собой распределённую систему для вычисления арифметических выражений. Система разбивает выражения на отдельные задачи, выполняет их параллельно с помощью агентов, а затем объединяет результаты. Пользователь может отправить выражение (например, 2+2*2), а система вернёт результат (в данном случае, 6).


Данный проект – это распределённый калькулятор выражений, который позволяет выполнять вычисления с использованием нескольких компонентов:

## Сервер (Оркестратор):
принимает арифметическое выражение от пользователя, сохраняет его и разбивает на отдельные задачи.
Регистрирует два типа API:
``` Публичные эндпоинты для получения и отправки выражений``` и ```Внутренние эндпоинты для общения с агентами.```

## Агент:
Независимый процесс, который постоянно опрашивает сервер, получает задачи на вычисление, выполняет их с искусственной задержкой и отправляет результат обратно на сервер.

## Фронтенд (Web):
Простая веб-страница, где пользователь может ввести арифметическое выражение и увидеть результат.

## Архитектура проекта
Проект построен по принципам чистой архитектуры и состоит из нескольких компонентов:

## Backend (Сервер):
Реализован на Go. Основные файлы находятся в папке ```cmd/server``` и ```internal/server```. 
Сервер:
принимает выражение через эндпоинт ```/api/v1/calculate```.
Сохраняет выражение и обновляет его статус (например, "pending", "in_progress", "done").
Разбивает выражение на задачи и кладёт их в очередь (файл task_manager.go).
Принимает результаты вычислений от агентов через эндпоинт ```/internal/task```.

## Agent (Агент):
Реализован на Go и запускается из ```cmd/agent```. 
Агент:
опрашивает сервер по эндпоинту ```/internal/task``` для получения задач.
Вычисляет полученную задачу (либо как целое выражение, либо как простую операцию).
Отправляет результат обратно на сервер.

## Frontend (Web):
Статические файлы в папке web:

```index.html``` – страница для ввода выражения.
```script.js``` – JavaScript, который отправляет запросы на сервер API и выводит результат.

Дополнительные компоненты:

Конфигурация: Файл ```internal/config/config.go``` загружает настройки (адрес, порт, время задержек и т.д.) из переменных окружения.
Хранилище: Файл ```internal/server/orchestrator.go``` хранит все выражения в памяти.
Логирование: Можно использовать стандартный пакет ```log```, чтобы отслеживать работу системы.
Пакет вычислений: Файл ```pkg/calculation/parser.go``` содержит алгоритм парсинга и вычисления арифметических выражений.

## Как это работает

Пользователь вводит арифметическое выражение на веб-странице (например, 2+2*2).
Фронтенд (script.js) отправляет POST-запрос на адрес ```http://localhost:8080/api/v1/calculate``` с введённым выражением.
Сервер (Оркестратор) получает запрос, сохраняет выражение с начальным статусом ```"pending"```, затем вызывает функцию разбиения выражения на задачи (например, DecomposeExpression) и меняет статус на ```"in_progress"```. Сервер возвращает уникальный ID выражения.
Агент опрашивает сервер по эндпоинту ```/internal/task``` и получает задачу из очереди.
Агент выполняет вычисление задачи:
если задача представляет собой целое выражение (например, "2+2*2"), агент использует алгоритм парсинга из ```pkg/calculation/parser.go```.
Если задача — простая операция с отдельными аргументами, агент выполняет операцию.
Агент отправляет результат вычисления на сервер через POST-запрос к эндпоинту ```/internal/task```.
Сервер обновляет статус выражения на ```"done"``` и сохраняет результат.
Пользователь может получить результат, отправив GET-запрос (или через фронтенд) на ```http://localhost:8080/api/v1/expressions/{id}```.

## Установка и запуск
1. Локальный запуск
  1. Сборка и запуск сервера:
     Откройте терминал в корневой директории проекта.
     Выполните команду:
     ```go run ./cmd/server```

Сервер запустится на порту 8080 (или на указанном в конфигурации).

  2. Сборка и запуск агента:
     В другом терминале выполните:
     ```go run ./cmd/agent```
Агент будет опрашивать сервер для получения задач.

2. Запуск фронтенда:
  1. Перейдите в папку web:
     ```cd web```
  2. Запустите простой HTTP-сервер для фронтенда (например, с помощью Python): 
     ```python -m http.server 8000```
     Откройте браузер и перейдите по адресу: ```http://localhost:8000```
     
3. Запуск через Docker Compose:
  1. Убедитесь, что Docker и Docker Compose установлены.
     В корневой директории проекта выполните команду:
     ```docker-compose up --build```
     Это соберёт образы для сервера и агента и запустит их. Сервер будет доступен по адресу: ```http://localhost:8080```. Фронтенд можно запустить отдельно (либо настроить раздачу статических файлов через сервер).
     
## Тестирование

Юнит-тесты: для запуска всех тестов выполните в корневой директории:

```go test ./...```

Это запустит тесты для всех пакетов, таких как ```pkg/calculation```, ```internal/storage``` и т.д.

Интеграционные тесты: вы можете протестировать API с помощью Postman или cURL:

Пример запроса POST (отправка выражения):

```curl -X POST -H "Content-Type: application/json" -d '{"expression": "2+2*2"}' http://localhost:8080/api/v1/calculate```

Пример запроса GET (получение результата):

```curl http://localhost:8080/api/v1/expressions/1```

## Тестирование через веб-интерфейс
Откройте веб-страницу ```http://localhost:8000``` (если запущен Python HTTP-сервер или Live Server в VS Code). Введите арифметическое выражение и нажмите кнопку "Вычислить". На странице появится информация о статусе вычисления и, когда агент выполнит задачу, результат отобразится.

Примеры использования: 
  1. Отправка выражения через cURL:

```curl -X POST -H "Content-Type: application/json" -d '{"expression": "2+2*2"}' http://localhost:8080/api/v1/calculate```

  2. Получение списка выражений:

```curl http://localhost:8080/api/v1/expressions```

  3. Получение конкретного выражения по ID:

```curl http://localhost:8080/api/v1/expressions/1```

## Заключение
Этот проект демонстрирует, как можно построить распределённую систему вычисления арифметических выражений. Он состоит из:

Сервера (Оркестратора), который принимает выражения, разбивает их на задачи и управляет их состоянием. Агентов, которые выполняют вычисления в параллельном режиме. Фронтенда, который предоставляет простой интерфейс для пользователя. Система легко масштабируется, тестируется и развертывается как локально, так и в контейнерах с помощью Docker Compose. Если что-то не получается, 90% - ошибка у меня, а не у вас. Простите грешника за ошибки и потенциально нерабочий web. Смотрите ```Терминал``` среды разработки...оно вроде работает..
